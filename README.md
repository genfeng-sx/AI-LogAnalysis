# AI安全日志分析工具

这是一个使用AI技术分析网络安全日志的跨平台应用程序。该工具可以帮助安全人员快速分析日志，判断告警的真实性，并提供置信度评估。

## 功能特点

- 支持多种日志格式（log、csv、txt）
- 跨平台兼容（Windows、Linux、macOS）
- 图形化界面，简单易用
- IP地址脱敏保护（对外传输时脱敏，本地显示原始IP）
- 支持多种AI服务商（DeepSeek、豆包等）
- 提供告警真实性评估和置信度打分

## 安装方法

1. 确保已安装Python 3.8+
2. 克隆此仓库
3. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
4. 运行应用程序：
   ```bash
   python main.py
   ```

## 使用方法

### 基本流程

1. 启动应用程序后，点击"加载日志文件"按钮选择要分析的日志文件
2. 在"告警信息"文本框中输入告警内容（可选）
3. 选择AI服务商（DeepSeek或豆包）
4. 点击"分析"按钮开始分析
5. 在结果区域查看分析结果

### 配置AI服务

首次使用前，需要在设置中配置AI服务商的API密钥：

1. 点击界面上的"设置"按钮
2. 切换到"API设置"选项卡
3. 输入相应AI服务商的API密钥
4. 点击"确定"保存设置

### IP脱敏功能

本程序内置IP脱敏功能，可以保护敏感IP地址：

- 默认情况下，发送给AI服务的数据会自动脱敏IP地址
- 界面上显示的内容会自动转换回原始IP，方便安全人员查看
- 可以在界面上通过"脱敏IP"复选框控制此功能

#### IP脱敏机制详解

IP脱敏采用了加密映射的方式，保护敏感信息同时保持数据的可用性：

1. **识别IP地址**：系统使用正则表达式识别文本中的IP地址（IPv4格式）
2. **加密与映射**：对每个识别到的IP地址进行Fernet加密（基于AES-128），然后根据原始IP的类别映射为类似真实IP的掩码地址
3. **映射表存储**：维护IP与掩码地址的双向映射关系，存储在本地加密的映射文件中
4. **自动转换**：在界面上显示时自动将脱敏IP地址转换回原始IP

##### 示例

原始日志：
```
2023-06-12 08:24:12 firewall[32541]: 连接被阻止：从 192.168.1.5 到 10.0.0.3:22 的连接尝试被阻止
```

发送给AI服务的脱敏日志：
```
2023-06-12 08:24:12 firewall[32541]: 连接被阻止：从 192.168.0.1 到 10.0.0.1:22 的连接尝试被阻止
```

用户界面显示（自动恢复原始IP）：
```
2023-06-12 08:24:12 firewall[32541]: 连接被阻止：从 192.168.1.5 到 10.0.0.3:22 的连接尝试被阻止
```

IP映射表（仅管理员可见）：
| 脱敏IP地址 | 原始IP地址 |
|------------|------------|
| 192.168.0.1 | 192.168.1.5 |
| 10.0.0.1 | 10.0.0.3 |

这种脱敏方式的优势：
- 保留了IP地址的格式特征，让AI模型能够更好地理解这是IP地址
- 根据原始IP的类别选择相应的私有IP范围进行掩码，保持语义相似性
- 有效保护敏感网络信息，防止在调用外部AI服务时泄露内部IP地址
- 不影响安全分析人员查看和理解原始日志内容

## 示例文件

在`examples`目录中提供了示例文件，可用于测试软件功能：

- `sample_firewall.log`: 示例防火墙日志文件
- `sample_alert.txt`: 示例告警内容

## 技术实现

本应用程序使用以下技术：

- **PyQt6**: 跨平台GUI框架
- **Pandas**: 数据处理和分析
- **Cryptography**: 安全加密实现
- **RESTful API**: 与AI服务商通信

## 目录结构

```
AI安全日志分析工具/
├── main.py                  # 主程序入口
├── requirements.txt         # 依赖项列表
├── README.md                # 说明文档
├── examples/                # 示例文件
│   ├── sample_firewall.log  # 示例防火墙日志
│   └── sample_alert.txt     # 示例告警内容
└── src/                     # 源代码目录
    ├── ai/                  # AI服务接口
    │   └── ai_service.py    # AI服务实现
    ├── gui/                 # 图形界面
    │   ├── main_window.py   # 主窗口
    │   └── settings_dialog.py # 设置对话框
    ├── utils/               # 工具类
    │   ├── config_manager.py # 配置管理
    │   ├── ip_masker.py     # IP脱敏工具
    │   └── log_parser.py    # 日志解析器
    └── data/                # 数据相关
```

## 配置文件

程序配置保存在用户主目录下的`.ai_log_analyzer`文件夹中：

- `config.json`: 主要配置信息
- `.env`: 敏感配置（如API密钥）
- `ip_mapping.json`: IP映射表
- `mask_key.key`: 加密密钥

## 已知限制

- 目前每次分析最多处理100行日志
- AI服务商需要有效的API密钥
- 大型日志文件可能需要更长处理时间

## 未来计划

- 添加更多AI服务商支持
- 实现更高级的日志解析能力
- 添加历史分析记录功能
- 支持更多日志格式

## 许可

本项目使用Apache许可证 
